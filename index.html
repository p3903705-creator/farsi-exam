<!doctype html>
<html lang="fa" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¢Ø²Ù…ÙˆÙ† ÙØ§Ø±Ø³ÛŒ Ù†ÙˆØ¨Øª Ø§ÙˆÙ„</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap');
    
    * {
      font-family: 'Vazirmatn', sans-serif;
    }
    
    .question-card {
      transition: all 0.3s ease;
    }
    
    .question-card:hover {
      transform: translateY(-2px);
    }
    
    .option-button {
      transition: all 0.2s ease;
    }
    
    .option-button:hover:not(.correct):not(.incorrect) {
      transform: scale(1.02);
    }
    
    .correct {
      animation: correctPulse 0.5s ease;
    }
    
    .incorrect {
      animation: shake 0.5s ease;
    }
    
    @keyframes correctPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto"></div>
  <script>
    const defaultConfig = {
      background_color: '#f0f4f8',
      surface_color: '#ffffff',
      text_color: '#1a202c',
      primary_action_color: '#3b82f6',
      secondary_action_color: '#10b981',
      font_family: 'Vazirmatn',
      font_size: 16,
      site_title: 'Ø¢Ø²Ù…ÙˆÙ† ÙØ§Ø±Ø³ÛŒ Ù†ÙˆØ¨Øª Ø§ÙˆÙ„ - Ú©Ù„Ø§Ø³ Ù‡Ø´ØªÙ…',
      welcome_message: 'Ø¢Ø²Ù…ÙˆÙ† Ø¯Ø±Ø³ ÙØ§Ø±Ø³ÛŒ Ù†ÙˆØ¨Øª Ø§ÙˆÙ„ (ØªØ§ Ù¾Ø§ÛŒØ§Ù† Ø¯Ø±Ø³ Û´)',
      start_button: 'Ø´Ø±ÙˆØ¹ Ø¢Ø²Ù…ÙˆÙ†',
      submit_button: 'Ø«Ø¨Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§',
      retry_button: 'Ø¢Ø²Ù…ÙˆÙ† Ù…Ø¬Ø¯Ø¯'
    };

    const questions = [
      {
        id: 1,
        text: 'Ø¯Ø±Ø³ Ø§ÙˆÙ„ Â«Ø¢ÛŒÛŒÙ†Ù‡â€ŒÛŒ Ø¯Ø§Ø±Â» Ù†ÙˆØ´ØªÙ‡ Ú©ÛŒØ³ØªØŸ',
        options: ['Ø¬Ù„Ø§Ù„ Ø¢Ù„ Ø§Ø­Ù…Ø¯', 'Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯', 'Ù‡ÙˆØ´Ù†Ú¯ Ù…Ø±Ø§Ø¯ÛŒ Ú©Ø±Ù…Ø§Ù†ÛŒ', 'Ù…Ø­Ù…Ø¯Ø¹Ù„ÛŒ Ø¬Ù…Ø§Ù„Ø²Ø§Ø¯Ù‡'],
        correct: 2
      },
      {
        id: 2,
        text: 'Ø¯Ø± Ø¬Ù…Ù„Ù‡ Â«Ú©ØªØ§Ø¨ Ø±Ø§ Ø®ÙˆØ§Ù†Ø¯Ù…Â» Ú©Ù„Ù…Ù‡ Â«Ø±Ø§Â» Ú†Ù‡ Ù†Ù‚Ø´ÛŒ Ø¯Ø§Ø±Ø¯ØŸ',
        options: ['Ù†Ø´Ø§Ù†Ù‡ Ù…ÙØ¹ÙˆÙ„', 'Ø­Ø±Ù Ø§Ø¶Ø§ÙÙ‡', 'Ø­Ø±Ù Ø±Ø¨Ø·', 'Ù†Ø´Ø§Ù†Ù‡ ÙØ§Ø¹Ù„'],
        correct: 0
      },
      {
        id: 3,
        text: 'Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ ÙØ¹Ù„ Ø§Ù…Ø± Ø§Ø³ØªØŸ',
        options: ['Ù…ÛŒâ€ŒØ±ÙˆØ¯', 'Ø¨Ù†ÙˆÛŒØ³', 'Ø±ÙØªÙ‡ Ø§Ø³Øª', 'Ø®ÙˆØ§Ù‡Ø¯ Ø±ÙØª'],
        correct: 1
      },
      {
        id: 4,
        text: 'Ø¯Ø±Ø³ Â«Ø§ÛŒ ÙˆØ§ÛŒ Ø§Ú¯Ø±Â» Ø§Ø«Ø± Ú©ÛŒØ³ØªØŸ',
        options: ['Ù…Ù‡Ø¯ÛŒ Ø¢Ø°Ø±ÛŒâ€ŒØ²Ø§Ø¯ÛŒ', 'Ø§Ø­Ù…Ø¯ Ø´Ø§Ù…Ù„Ùˆ', 'Ø³Ù‡Ø±Ø§Ø¨ Ø³Ù¾Ù‡Ø±ÛŒ', 'ÙØ±ÙˆØº ÙØ±Ø®Ø²Ø§Ø¯'],
        correct: 0
      },
      {
        id: 5,
        text: 'Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡ ØªØ´Ø¨ÛŒÙ‡ Ø§Ø³ØªØŸ',
        options: ['Ø¯Ù„Ù… Ú¯Ø±ÙØªÙ‡ Ø§Ø³Øª', 'Ú†Ù‡Ø±Ù‡â€ŒØ§Ø´ Ù…Ø§Ù†Ù†Ø¯ Ù…Ø§Ù‡ Ø¨ÙˆØ¯', 'Ø¨Ø§Ø±Ø§Ù† Ù…ÛŒâ€ŒØ¨Ø§Ø±Ø¯', 'Ø®ÙˆØ±Ø´ÛŒØ¯ Ø·Ù„ÙˆØ¹ Ú©Ø±Ø¯'],
        correct: 1
      },
      {
        id: 6,
        text: 'Ø¯Ø± Ø¬Ù…Ù„Ù‡ Â«Ø¹Ù„ÛŒ Ú©ØªØ§Ø¨ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯Â» Ú©Ù„Ù…Ù‡ Â«Ø¹Ù„ÛŒÂ» Ú†Ù‡ Ù†Ù‚Ø´ Ø¯Ø³ØªÙˆØ±ÛŒ Ø¯Ø§Ø±Ø¯ØŸ',
        options: ['Ù…ÙØ¹ÙˆÙ„', 'ÙØ§Ø¹Ù„', 'Ù…ØªÙ…Ù…', 'Ù…Ø³Ù†Ø¯'],
        correct: 1
      },
      {
        id: 7,
        text: 'ÙˆØ§Ú˜Ù‡ Â«Ø¯Ø³ØªØ§Ù†Â» Ú†Ù‡ Ù†ÙˆØ¹ Ø¬Ù…Ø¹ÛŒ Ø§Ø³ØªØŸ',
        options: ['Ø¬Ù…Ø¹ Ù…Ú©Ø³Ø± Ø¹Ø±Ø¨ÛŒ', 'Ø¬Ù…Ø¹ Ø³Ø§Ù„Ù… Ø¹Ø±Ø¨ÛŒ', 'Ø¬Ù…Ø¹ ÙØ§Ø±Ø³ÛŒ', 'Ø¬Ù…Ø¹ Ø´Ú©Ø³ØªÙ‡ ÙØ§Ø±Ø³ÛŒ'],
        correct: 2
      },
      {
        id: 8,
        text: 'Ø¯Ø±Ø³ Ø³ÙˆÙ… Â«Ù‚Ø¯Ø± Ø¯Ø§Ù†Ø³ØªÙ†Â» Ø¯Ø± Ù…ÙˆØ±Ø¯ Ú†Ù‡ Ù…ÙˆØ¶ÙˆØ¹ÛŒ Ø§Ø³ØªØŸ',
        options: ['Ø§Ø­ØªØ±Ø§Ù… Ø¨Ù‡ Ø¨Ø²Ø±Ú¯ØªØ±Ù‡Ø§', 'Ø´Ú©Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§Ø² Ù†Ø¹Ù…Øªâ€ŒÙ‡Ø§', 'ØªØ§Ø±ÛŒØ® Ø§ÛŒØ±Ø§Ù†', 'Ø¹Ù„Ù… Ùˆ Ø¯Ø§Ù†Ø´'],
        correct: 1
      },
      {
        id: 9,
        text: 'Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ ÙØ¹Ù„ Ù…Ø§Ø¶ÛŒ Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªØŸ',
        options: ['Ù…ÛŒâ€ŒØ±ÙØª', 'Ø±ÙØªÙ‡ Ø¨ÙˆØ¯', 'Ø±ÙØª', 'Ø®ÙˆØ§Ù‡Ø¯ Ø±ÙØª'],
        correct: 2
      },
      {
        id: 10,
        text: 'ÙˆØ§Ú˜Ù‡ Â«Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡Â» Ú†Ù‡ Ù†ÙˆØ¹ Ø³Ø§Ø®Øª ÙˆØ§Ú˜Ù‡â€ŒØ§ÛŒ Ø¯Ø§Ø±Ø¯ØŸ',
        options: ['Ø³Ø§Ø¯Ù‡', 'Ù…Ø±Ú©Ø¨', 'Ù…Ø´ØªÙ‚', 'ÙˆØ§Ù…ÛŒ'],
        correct: 1
      },
      {
        id: 11,
        text: 'Ú©Ø¯Ø§Ù… ÙˆØ§Ú˜Ù‡ Ù…ØªØ±Ø§Ø¯Ù Â«Ø´Ø§Ø¯Ù…Ø§Ù†ÛŒÂ» Ø§Ø³ØªØŸ',
        options: ['Ø§Ù†Ø¯ÙˆÙ‡', 'Ø®ÙˆØ´ÛŒ', 'Ù†Ú¯Ø±Ø§Ù†ÛŒ', 'ØªØ±Ø³'],
        correct: 1
      },
      {
        id: 12,
        text: 'Ø¯Ø± Ø¹Ø¨Ø§Ø±Øª Â«Ø´Ø¨ ØªØ§Ø±ÛŒÚ© Ùˆ Ø±ÙˆØ² Ø±ÙˆØ´Ù†Â» Ú©Ø¯Ø§Ù… Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø¯Ø¨ÛŒ Ø¨Ù‡ Ú©Ø§Ø± Ø±ÙØªÙ‡ØŸ',
        options: ['ØªØ´Ø¨ÛŒÙ‡', 'Ø§Ø³ØªØ¹Ø§Ø±Ù‡', 'Ú©Ù†Ø§ÛŒÙ‡', 'ØªØ¶Ø§Ø¯'],
        correct: 3
      },
      {
        id: 13,
        text: 'ÙØ¹Ù„ Â«Ø¨Ø®ÙˆØ§Ù†Â» Ø¯Ø± Ú†Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø§Ø³ØªØŸ',
        options: ['Ù…Ø§Ø¶ÛŒ', 'Ù…Ø¶Ø§Ø±Ø¹', 'Ø§Ù…Ø±', 'Ù…Ø¶Ø§Ø±Ø¹ Ø§Ù„ØªØ²Ø§Ù…ÛŒ'],
        correct: 2
      },
      {
        id: 14,
        text: 'Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ Ù…ØªØ¶Ø§Ø¯ Â«Ø¨Ø®Ù„Â» Ø§Ø³ØªØŸ',
        options: ['Ø³Ø®Ø§ÙˆØª', 'Ø®Ø³Ø§Ø³Øª', 'Ø­Ø³Ø¯', 'ØªÙ†Ø¨Ù„ÛŒ'],
        correct: 0
      },
      {
        id: 15,
        text: 'Ø¯Ø±Ø³ Ú†Ù‡Ø§Ø±Ù… Â«Ù†ÛŒÚ©ÛŒ Ú©Ù†Â» Ø¨Ø± Ú©Ø¯Ø§Ù… Ø§Ø±Ø²Ø´ Ø§Ø®Ù„Ø§Ù‚ÛŒ ØªØ£Ú©ÛŒØ¯ Ø¯Ø§Ø±Ø¯ØŸ',
        options: ['Ø¬Ù†Ú¯ Ùˆ Ø¯ÙØ§Ø¹', 'Ø§Ø­Ø³Ø§Ù† Ùˆ Ù†ÛŒÚ©ÙˆÚ©Ø§Ø±ÛŒ', 'Ø¹Ù„Ù… Ùˆ Ø¯Ø§Ù†Ø´', 'ÙˆØ·Ù†â€ŒØ¯ÙˆØ³ØªÛŒ'],
        correct: 1
      },
      {
        id: 16,
        text: 'Ø¯Ø± Ø¬Ù…Ù„Ù‡ Â«Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯Â» Ú©Ù„Ù…Ù‡ Â«Ø¨Ú†Ù‡â€ŒÙ‡Ø§Â» Ú†Ù‡ Ù†Ù‚Ø´ÛŒ Ø¯Ø§Ø±Ø¯ØŸ',
        options: ['Ù…ÙØ¹ÙˆÙ„', 'ÙØ§Ø¹Ù„', 'Ù‚ÛŒØ¯', 'Ù…Ø³Ù†Ø¯'],
        correct: 1
      },
      {
        id: 17,
        text: 'Ú©Ø¯Ø§Ù… ÙˆØ§Ú˜Ù‡ Ù…ØµØ¯Ø± Ø§Ø³ØªØŸ',
        options: ['Ø±ÙØªØ§Ø±', 'Ø±ÙØªÙ†', 'Ù…ÛŒâ€ŒØ±ÙˆØ¯', 'Ø¨Ø±Ùˆ'],
        correct: 1
      },
      {
        id: 18,
        text: 'Ø¯Ø± Ø´Ø¹Ø± Â«Ú¯Ø± Ú†Ù‡ ØªÙ„Ø® Ø§Ø³Øª Ø§ÛŒÙ† Ø¯ÙˆØ§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ØªÂ» Ù…Ù†Ø¸ÙˆØ± Ø§Ø² Â«Ø¯ÙˆØ§Â» Ú†ÛŒØ³ØªØŸ',
        options: ['Ø¯Ø§Ø±Ùˆ', 'Ù¾Ù†Ø¯ Ùˆ Ø§Ù†Ø¯Ø±Ø²', 'Ø¨ÛŒÙ…Ø§Ø±ÛŒ', 'Ø¢Ø¨'],
        correct: 1
      },
      {
        id: 19,
        text: 'Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ Ø­Ø±Ù Ø§Ø¶Ø§ÙÙ‡ Ø§Ø³ØªØŸ',
        options: ['Ø¯Ø±', 'Ùˆ', 'Ø±Ø§', 'Ú©Ù‡'],
        correct: 0
      },
      {
        id: 20,
        text: 'Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø´ØªØ±Ú© Ú†Ù‡Ø§Ø± Ø¯Ø±Ø³ Ù†ÙˆØ¨Øª Ø§ÙˆÙ„ Ú†ÛŒØ³ØªØŸ',
        options: ['ØªØ§Ø±ÛŒØ® Ø§ÛŒØ±Ø§Ù†', 'Ø§Ø®Ù„Ø§Ù‚ Ùˆ Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ', 'Ø¹Ù„ÙˆÙ… Ø·Ø¨ÛŒØ¹ÛŒ', 'Ø±ÛŒØ§Ø¶ÛŒØ§Øª'],
        correct: 1
      }
    ];

    let currentView = 'home';
    let userAnswers = new Array(questions.length).fill(null);
    let testHistory = [];
    let isSubmitting = false;

    const dataHandler = {
      onDataChanged(data) {
        testHistory = data;
        if (currentView === 'home') {
          renderApp();
        }
      }
    };

    async function initializeApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
      }
    }

    function generateTestId() {
      return `test_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    async function submitTest() {
      if (isSubmitting) return;
      
      const unanswered = userAnswers.some(a => a === null);
      if (unanswered) {
        showToast('Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ù‡Ù…Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯');
        return;
      }

      if (testHistory.length >= 999) {
        showToast('Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ (Û¹Û¹Û¹) Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
        return;
      }

      isSubmitting = true;
      renderApp();

      const score = userAnswers.reduce((acc, answer, index) => {
        return acc + (answer === questions[index].correct ? 1 : 0);
      }, 0);

      const testData = {
        test_id: generateTestId(),
        score: score,
        total_questions: questions.length,
        completed_at: new Date().toISOString(),
        answers: JSON.stringify(userAnswers)
      };

      const createResult = await window.dataSdk.create(testData);
      
      isSubmitting = false;

      if (createResult.isOk) {
        currentView = 'results';
        renderApp();
      } else {
        showToast('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ Ø¢Ø²Ù…ÙˆÙ†');
        renderApp();
      }
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 50%;
        transform: translateX(50%);
        background: ${window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color};
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
        font-size: ${(window.elementSdk?.config?.font_size || defaultConfig.font_size) * 0.9}px;
      `;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function startTest() {
      currentView = 'test';
      userAnswers = new Array(questions.length).fill(null);
      renderApp();
    }

    function selectAnswer(questionIndex, optionIndex) {
      userAnswers[questionIndex] = optionIndex;
      renderApp();
    }

    function goHome() {
      currentView = 'home';
      renderApp();
    }

    async function onConfigChange(config) {
      const app = document.getElementById('app');
      if (!app) return;

      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;

      document.body.style.backgroundColor = backgroundColor;
      document.body.style.color = textColor;
      document.body.style.fontFamily = `${fontFamily}, Vazirmatn, sans-serif`;

      const allText = app.querySelectorAll('*');
      allText.forEach(el => {
        el.style.color = textColor;
        el.style.fontFamily = `${fontFamily}, Vazirmatn, sans-serif`;
      });

      const containers = app.querySelectorAll('.question-card, .history-card');
      containers.forEach(el => {
        el.style.backgroundColor = surfaceColor;
      });

      const primaryButtons = app.querySelectorAll('.primary-button');
      primaryButtons.forEach(btn => {
        btn.style.backgroundColor = primaryColor;
      });

      const secondaryButtons = app.querySelectorAll('.secondary-button');
      secondaryButtons.forEach(btn => {
        btn.style.backgroundColor = secondaryColor;
      });

      const titles = app.querySelectorAll('.title');
      titles.forEach(el => {
        el.style.fontSize = `${fontSize * 2}px`;
      });

      const subtitles = app.querySelectorAll('.subtitle');
      subtitles.forEach(el => {
        el.style.fontSize = `${fontSize * 1.5}px`;
      });

      const bodyText = app.querySelectorAll('.body-text');
      bodyText.forEach(el => {
        el.style.fontSize = `${fontSize}px`;
      });

      const smallText = app.querySelectorAll('.small-text');
      smallText.forEach(el => {
        el.style.fontSize = `${fontSize * 0.875}px`;
      });

      const buttons = app.querySelectorAll('button');
      buttons.forEach(btn => {
        btn.style.fontSize = `${fontSize}px`;
      });
    }

    function renderApp() {
      const config = window.elementSdk?.config || defaultConfig;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;

      document.body.style.backgroundColor = backgroundColor;
      document.body.style.fontFamily = `${fontFamily}, Vazirmatn, sans-serif`;

      const app = document.getElementById('app');

      if (currentView === 'home') {
        app.innerHTML = `
          <div style="background-color: ${backgroundColor}; min-height: 100%; padding: 32px 16px;">
            <div style="max-width: 800px; margin: 0 auto;">
              <h1 class="title" style="font-size: ${fontSize * 2}px; font-weight: bold; text-align: center; margin-bottom: 8px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                ${config.site_title || defaultConfig.site_title}
              </h1>
              <p class="body-text" style="font-size: ${fontSize}px; text-align: center; margin-bottom: 32px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                ${config.welcome_message || defaultConfig.welcome_message}
              </p>
              
              <div class="question-card" style="background-color: ${surfaceColor}; border-radius: 12px; padding: 32px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 32px;">
                <h2 class="subtitle" style="font-size: ${fontSize * 1.5}px; font-weight: 600; margin-bottom: 16px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  ğŸ“ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¢Ø²Ù…ÙˆÙ†
                </h2>
                <div class="body-text" style="font-size: ${fontSize}px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif; line-height: 1.6;">
                  <p style="margin-bottom: 12px;">â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª: ${questions.length} Ø³ÙˆØ§Ù„</p>
                  <p style="margin-bottom: 12px;">â€¢ Ø¯Ø±ÙˆØ³: Ø¢ÛŒÛŒÙ†Ù‡â€ŒÛŒ Ø¯Ø§Ø±ØŒ Ø§ÛŒ ÙˆØ§ÛŒ Ø§Ú¯Ø±ØŒ Ù‚Ø¯Ø± Ø¯Ø§Ù†Ø³ØªÙ†ØŒ Ù†ÛŒÚ©ÛŒ Ú©Ù†</p>
                  <p style="margin-bottom: 12px;">â€¢ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª: Ø¯Ø³ØªÙˆØ± Ø²Ø¨Ø§Ù†ØŒ Ø¢Ø±Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¯Ø¨ÛŒØŒ ÙˆØ§Ú˜Ú¯Ø§Ù†</p>
                  <p style="margin-bottom: 24px;">â€¢ Ø²Ù…Ø§Ù†: Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯</p>
                  <button onclick="startTest()" class="primary-button option-button" style="background-color: ${primaryColor}; color: white; width: 100%; padding: 16px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer; font-size: ${fontSize}px; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                    ${config.start_button || defaultConfig.start_button}
                  </button>
                </div>
              </div>

              ${testHistory.length > 0 ? `
                <div class="question-card" style="background-color: ${surfaceColor}; border-radius: 12px; padding: 32px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <h2 class="subtitle" style="font-size: ${fontSize * 1.5}px; font-weight: 600; margin-bottom: 16px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                    ğŸ“Š ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§
                  </h2>
                  <div style="display: grid; gap: 12px;">
                    ${testHistory.slice(-5).reverse().map(test => {
                      const date = new Date(test.completed_at);
                      const percentage = Math.round((test.score / test.total_questions) * 100);
                      return `
                        <div class="history-card" style="background-color: ${backgroundColor}; padding: 16px; border-radius: 8px;">
                          <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                              <p class="body-text" style="font-size: ${fontSize}px; font-weight: 600; margin-bottom: 4px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                                Ù†Ù…Ø±Ù‡: ${test.score} Ø§Ø² ${test.total_questions} (${percentage}Ùª)
                              </p>
                              <p class="small-text" style="font-size: ${fontSize * 0.875}px; color: ${textColor}; opacity: 0.7; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                                ${date.toLocaleDateString('fa-IR')} - ${date.toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}
                              </p>
                            </div>
                            <div style="font-size: ${fontSize * 1.5}px;">
                              ${percentage >= 80 ? 'ğŸ†' : percentage >= 60 ? 'ğŸ‘' : 'ğŸ“š'}
                            </div>
                          </div>
                        </div>
                      `;
                    }).join('')}
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
        `;
      } else if (currentView === 'test') {
        app.innerHTML = `
          <div style="background-color: ${backgroundColor}; min-height: 100%; padding: 32px 16px;">
            <div style="max-width: 800px; margin: 0 auto;">
              <h1 class="title" style="font-size: ${fontSize * 2}px; font-weight: bold; text-align: center; margin-bottom: 32px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                Ø¢Ø²Ù…ÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…
              </h1>
              
              <div style="display: grid; gap: 24px;">
                ${questions.map((q, qIndex) => `
                  <div class="question-card" style="background-color: ${surfaceColor}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 class="subtitle" style="font-size: ${fontSize * 1.25}px; font-weight: 600; margin-bottom: 16px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                      ${qIndex + 1}. ${q.text}
                    </h3>
                    <div style="display: grid; gap: 12px;">
                      ${q.options.map((option, oIndex) => `
                        <button 
                          onclick="selectAnswer(${qIndex}, ${oIndex})"
                          class="option-button ${userAnswers[qIndex] === oIndex ? 'secondary-button' : ''}"
                          style="background-color: ${userAnswers[qIndex] === oIndex ? secondaryColor : backgroundColor}; 
                                 color: ${userAnswers[qIndex] === oIndex ? 'white' : textColor};
                                 padding: 16px; 
                                 border-radius: 8px; 
                                 text-align: right; 
                                 border: 2px solid ${userAnswers[qIndex] === oIndex ? secondaryColor : 'transparent'}; 
                                 cursor: pointer;
                                 font-size: ${fontSize}px;
                                 font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                          ${option}
                        </button>
                      `).join('')}
                    </div>
                  </div>
                `).join('')}
              </div>

              <div style="margin-top: 32px; display: flex; gap: 12px; justify-content: center;">
                <button 
                  onclick="goHome()"
                  style="background-color: ${backgroundColor}; 
                         color: ${textColor}; 
                         padding: 16px 32px; 
                         border-radius: 8px; 
                         font-weight: 600; 
                         border: 2px solid ${textColor}; 
                         cursor: pointer;
                         font-size: ${fontSize}px;
                         font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  Ø¨Ø§Ø²Ú¯Ø´Øª
                </button>
                <button 
                  onclick="submitTest()"
                  class="primary-button option-button"
                  ${isSubmitting ? 'disabled' : ''}
                  style="background-color: ${primaryColor}; 
                         color: white; 
                         padding: 16px 32px; 
                         border-radius: 8px; 
                         font-weight: 600; 
                         border: none; 
                         cursor: ${isSubmitting ? 'not-allowed' : 'pointer'};
                         opacity: ${isSubmitting ? '0.6' : '1'};
                         font-size: ${fontSize}px;
                         font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  ${isSubmitting ? 'Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª...' : (config.submit_button || defaultConfig.submit_button)}
                </button>
              </div>
            </div>
          </div>
        `;
      } else if (currentView === 'results') {
        const score = userAnswers.reduce((acc, answer, index) => {
          return acc + (answer === questions[index].correct ? 1 : 0);
        }, 0);
        const percentage = Math.round((score / questions.length) * 100);

        app.innerHTML = `
          <div style="background-color: ${backgroundColor}; min-height: 100%; padding: 32px 16px;">
            <div style="max-width: 800px; margin: 0 auto;">
              <div class="question-card" style="background-color: ${surfaceColor}; border-radius: 12px; padding: 32px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 32px; text-align: center;">
                <div style="font-size: ${fontSize * 4}px; margin-bottom: 16px;">
                  ${percentage >= 80 ? 'ğŸ‰' : percentage >= 60 ? 'ğŸ‘' : 'ğŸ’ª'}
                </div>
                <h1 class="title" style="font-size: ${fontSize * 2}px; font-weight: bold; margin-bottom: 8px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  Ù†ØªÛŒØ¬Ù‡ Ø¢Ø²Ù…ÙˆÙ†
                </h1>
                <p class="subtitle" style="font-size: ${fontSize * 2}px; font-weight: bold; color: ${primaryColor}; margin-bottom: 8px; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  ${score} Ø§Ø² ${questions.length}
                </p>
                <p class="body-text" style="font-size: ${fontSize * 1.25}px; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  ${percentage}Ùª Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                </p>
              </div>

              <div style="display: grid; gap: 24px; margin-bottom: 32px;">
                ${questions.map((q, qIndex) => {
                  const userAnswer = userAnswers[qIndex];
                  const isCorrect = userAnswer === q.correct;
                  return `
                    <div class="question-card ${isCorrect ? 'correct' : 'incorrect'}" style="background-color: ${surfaceColor}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-right: 4px solid ${isCorrect ? secondaryColor : '#ef4444'};">
                      <div style="display: flex; align-items: start; gap: 12px; margin-bottom: 16px;">
                        <span style="font-size: ${fontSize * 1.5}px;">${isCorrect ? 'âœ…' : 'âŒ'}</span>
                        <h3 class="subtitle" style="font-size: ${fontSize * 1.25}px; font-weight: 600; color: ${textColor}; font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                          ${qIndex + 1}. ${q.text}
                        </h3>
                      </div>
                      <div style="display: grid; gap: 8px;">
                        ${q.options.map((option, oIndex) => {
                          let bgColor = backgroundColor;
                          let txtColor = textColor;
                          let borderColor = 'transparent';
                          
                          if (oIndex === q.correct) {
                            bgColor = secondaryColor;
                            txtColor = 'white';
                          } else if (oIndex === userAnswer && !isCorrect) {
                            bgColor = '#fee2e2';
                            borderColor = '#ef4444';
                          }
                          
                          return `
                            <div style="background-color: ${bgColor}; 
                                        color: ${txtColor}; 
                                        padding: 12px 16px; 
                                        border-radius: 8px; 
                                        border: 2px solid ${borderColor};
                                        font-size: ${fontSize}px;
                                        font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                              ${option} ${oIndex === q.correct ? 'âœ“' : ''}
                            </div>
                          `;
                        }).join('')}
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>

              <div style="display: flex; gap: 12px; justify-content: center;">
                <button 
                  onclick="goHome()"
                  style="background-color: ${backgroundColor}; 
                         color: ${textColor}; 
                         padding: 16px 32px; 
                         border-radius: 8px; 
                         font-weight: 600; 
                         border: 2px solid ${textColor}; 
                         cursor: pointer;
                         font-size: ${fontSize}px;
                         font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø®Ø§Ù†Ù‡
                </button>
                <button 
                  onclick="startTest()"
                  class="primary-button option-button"
                  style="background-color: ${primaryColor}; 
                         color: white; 
                         padding: 16px 32px; 
                         border-radius: 8px; 
                         font-weight: 600; 
                         border: none; 
                         cursor: pointer;
                         font-size: ${fontSize}px;
                         font-family: ${fontFamily}, Vazirmatn, sans-serif;">
                  ${config.retry_button || defaultConfig.retry_button}
                </button>
              </div>
            </div>
          </div>
        `;
      }
    }

    window.elementSdk.init({
      defaultConfig,
      onConfigChange,
      mapToCapabilities: (config) => ({
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              config.surface_color = value;
              window.elementSdk.setConfig({ surface_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              config.secondary_action_color = value;
              window.elementSdk.setConfig({ secondary_action_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            config.font_family = value;
            window.elementSdk.setConfig({ font_family: value });
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            config.font_size = value;
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      }),
      mapToEditPanelValues: (config) => new Map([
        ['site_title', config.site_title || defaultConfig.site_title],
        ['welcome_message', config.welcome_message || defaultConfig.welcome_message],
        ['start_button', config.start_button || defaultConfig.start_button],
        ['submit_button', config.submit_button || defaultConfig.submit_button],
        ['retry_button', config.retry_button || defaultConfig.retry_button]
      ])
    });

    initializeApp().then(() => {
      renderApp();
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b29f6a8e30dd821',t:'MTc2NjUxNDk3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
